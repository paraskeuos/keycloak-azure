events {}

http {
  server {
    listen {{ reverse_proxy_port }} ssl;
    server_name {{ host_ip }};

    ssl_certificate /etc/nginx/ssl/{{ cert_public }};
    ssl_certificate_key /etc/nginx/ssl/{{ cert_private }};

    location /auth/ {
      proxy_pass http://host.containers.internal:{{ kc_port }};
      
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
      proxy_pass http://host.containers.internal:{{ oauth2_proxy_port }};
		
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
}
